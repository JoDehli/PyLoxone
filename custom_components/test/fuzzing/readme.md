# Fuzzing
## What is Fuzzing
Fuzzing, or fuzz testing, is a software testing technique used to find vulnerabilities and bugs by inputting large amounts of random data, called "fuzz," into a program. 
The goal is to induce unexpected behavior, crashes, or memory leaks, thereby revealing security issues and flaws that might not be detected through traditional testing methods. 
By systematically feeding malformed or semi-random data to the software, fuzzing helps developers identify and fix critical vulnerabilities, enhancing the overall robustness and security of the application.

## Why are we fuzzing?
We are 5 students, and we have to fuzz an open source project for a grade bonus. 
So here we are!

## Start to fuzz
### Setup
1. create a virtual environment:

You can create the virtual environment in the project's root directory (recommended) or any other directory of your choice.
```shell
python -m venv venv
```
2. activate the virtual environment:

Windows
```shell
.\venv\Scripts\activate
```

Linux and macOS
```shell
source venv/bin/activate
```

3.  install the following packages:
```shell
pip install pytest
pip install pytest-timeout
pip install homeassistant
pip install numpy
```
4. you maybe have to tell python were to find the `PyLoxone` project 

Windows
- Go to the Windows menu and search for "Environment Variables".
- Select “Advanced system settings”.
- In the “System Properties” window, click the “Environment Variables” button.
- Click the “New” button in the top half of the dialog, to make a new user variable.
- Name the variable PYTHONPATH and set its value to the path of your code directory. Click "OK" and "OK" again to save.

Linux and macOS
```shell
export PYTHONPATH=$PYTHONPATH:/path/to/PyLoxone
```
### Run
- start the execution in the root of the repo
```shell
cd /path/to/PyLoxone
```
- run `pytest`
```shell
pytest
```
- if you only want to run a single test file, you can enter the path to the file:
```shell
pytest custom_components/test/path/to/test_file.py
```

## Fuzzer layout (UML)
![fuzzer_overview](fuzzer_overview.svg)

# TODO
## Presentation 2024-07-05
### Intro
What is `PyLoxone`?
Our general approach with `pytest`.

### Implementation
#### 1. @jonathanheitzmann presenting
  - value pools: 
    - Explains `ValuePool` and `ValuePoolFuzzer` using the UML diagram.
    - Shows corresponding test cases in `test_vp_on_helpers.py`
    - What problems did I have
#### 2. @dsiev presenting
  - generators 
    - Explains `???` and `???` using the UML diagram.
    - Shows corresponding test cases in `???.py`.
    - What problems did I have
#### 3. @JKortmann presenting
  - grammars 
    - Explains `GrammerFuzzer` and `grammar_pool` using the UML diagram.
    - Shows corresponding test cases in `test_vp_on_helpers.py`.
    - What problems did I have
#### 4. @ThorbenCarl presenting
  - black box mutational 
    - Explains `MutationalFuzzer` using the UML diagram.
    - Shows corresponding test cases in `test_mut_on_helpers.py`.
    - What problems did I have
#### 5. @hoegma presenting
  - grey box mutational 
    - Explains `???` using the UML diagram.
    - Shows corresponding test cases in `???.py`.
    - What problems did I have

### Conclusion 
- Problems with specification, what is an illegal test input if there is no specification?
- What did we think of the project? Did the grade bonus make sense?


## Value pools 
> - Assigned to: @jonathanheitzmann
> - Branch: `fuzzing/valuepool`
  - [ ] Bug in `__DICT_POOL` the dict `{0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7, 8: 8, 9: 9}` generated by `{i: i for i in range(10)}` is not a valid JSON.

## Generators
> - Assigned to: @dsiev
> - Branch: `fuzzing/generators`
- Implement the generators.
  - [x] Get code running.
  - [x] Update UML.
  - [ ] Write `test_gen_on_demo.py`
  - [ ] (Optional) Create test case on PyLoxone

## Input grammars
> - Assigned to: @JKortmann

## Mutational 
### black-box
> - Assigned to: @ThorbenCarl
> - Branch: `fuzzing/mutational_black_box`

### grey-box
> - Assigned to: @hoegma
> - Branch: `fuzzing/mutational_grey_box`
- [ ] Implement the mutational fuzzing (grey-box).
  - [x] Get code running
  - [x] Update UML
  - [x] Create test cases

# Vulnerabilities found
## `helpers.py`
### `map_range()`
- A possible 0 division is not checked or intercepted.
- If `in_max` and `in_min` are equal.

### `get_all()`
- If the key `controls` or `type` is not in the `json_data: dict` the function crashes.